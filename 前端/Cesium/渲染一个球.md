# Cesium 如何创建一个球

## 分析

1. 传入容器Id，创建Viewer

    > Viewer是Cesium的入口，是Cesium对外提供的顶层接口，统领全局的变量
    > + 创建界面所需要容器div，创建界面控件（timeline、animation、home等button）与核心类CesiumWidget
    > + 将变量挂载到Viewer类下
    > + 创建事件监听，定义事件处理函数，包括界面事件（鼠标双击、单击拾取实体）和实体添加删除事件

2.  CesiumWidget  
   > + 创建Cesium 版权信息容器，初始化信息
   > + 创建canvas，创建场景（new Scene）
   > + 创建Globe，将实例化的globe赋给scene的globe属性
   > + 开始渲染循环。通过（requestAnimationFrame）调用scene的render函数
3. Globe
   > + 构造函数: 创建影像图层、地形图层集合、并将地形影像作为参数创建地球表面瓦片提供者（GlobeSurfaceTileProvider）， 再将地球表面瓦片提供者作为参数创建地球表面（surface = new QuadTreePrimitve）
   > + 定义原型上的beginFrame函数
   > + 定义原型上update函数，调用surface.update
4. QuadTree 四叉树
   > + 
   > + 定义原型上的update函数，调用tileProvider的update函数，更新瓦片
5.  Scene

    > + 构造函数：获取canvas，创建webgl上下文（Content），初始化地球环境状态，创建相机，
    > + 定义原型render，确定render事件顺序（preUpdate、globe.update、postUpdate、render、preRender、postRender）
    > + 定义函数render，开始渲染地球（scene.globe.beginFrame），更新环境（updateEnvironment），执行渲染（updateAndExecuteCommands--更新primitive），结束渲染地球（scene.globe.endFrame--渲染瓦片）

> updateAndExecuteCommands 会更新scene下所有的primtives（三类 groundPrimitives的update、primitives的update、globe的render）

> DrawCommand--调用context._gl.drawArrays()与gl.drawElements()绘制

1. Context
 >  + 构造函数：获取上下文（canvas.getContext('webgl') 或者webgl2） 
